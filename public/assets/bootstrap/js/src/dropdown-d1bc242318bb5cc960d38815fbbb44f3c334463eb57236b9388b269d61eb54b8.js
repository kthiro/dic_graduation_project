import $ from"jquery";import Popper from"popper.js";import Util from"./util";const Dropdown=(e=>{const t="dropdown",n="4.1.3",o="bs.dropdown",r=`.${o}`,i=".data-api",s=e.fn[t],a=27,l=32,c=9,h=38,f=40,p=3,d=new RegExp(`${h}|${f}|${a}`),u={HIDE:`hide${r}`,HIDDEN:`hidden${r}`,SHOW:`show${r}`,SHOWN:`shown${r}`,CLICK:`click${r}`,CLICK_DATA_API:`click${r}${i}`,KEYDOWN_DATA_API:`keydown${r}${i}`,KEYUP_DATA_API:`keyup${r}${i}`},_={DISABLED:"disabled",SHOW:"show",DROPUP:"dropup",DROPRIGHT:"dropright",DROPLEFT:"dropleft",MENURIGHT:"dropdown-menu-right",MENULEFT:"dropdown-menu-left",POSITION_STATIC:"position-static"},g={DATA_TOGGLE:'[data-toggle="dropdown"]',FORM_CHILD:".dropdown form",MENU:".dropdown-menu",NAVBAR_NAV:".navbar-nav",VISIBLE_ITEMS:".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)"},m={TOP:"top-start",TOPEND:"top-end",BOTTOM:"bottom-start",BOTTOMEND:"bottom-end",RIGHT:"right-start",RIGHTEND:"right-end",LEFT:"left-start",LEFTEND:"left-end"},E={offset:0,flip:!0,boundary:"scrollParent",reference:"toggle",display:"dynamic"},T={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)",reference:"(string|element)",display:"string"};class A{constructor(e,t){this._element=e,this._popper=null,this._config=this._getConfig(t),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}static get VERSION(){return n}static get Default(){return E}static get DefaultType(){return T}toggle(){if(this._element.disabled||e(this._element).hasClass(_.DISABLED))return;const t=A._getParentFromElement(this._element),n=e(this._menu).hasClass(_.SHOW);if(A._clearMenus(),n)return;const o={relatedTarget:this._element},r=e.Event(u.SHOW,o);if(e(t).trigger(r),!r.isDefaultPrevented()){if(!this._inNavbar){if(void 0===Popper)throw new TypeError("Bootstrap dropdown require Popper.js (https://popper.js.org)");let n=this._element;"parent"===this._config.reference?n=t:Util.isElement(this._config.reference)&&(n=this._config.reference,"undefined"!=typeof this._config.reference.jquery&&(n=this._config.reference[0])),"scrollParent"!==this._config.boundary&&e(t).addClass(_.POSITION_STATIC),this._popper=new Popper(n,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===e(t).closest(g.NAVBAR_NAV).length&&e(document.body).children().on("mouseover",null,e.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),e(this._menu).toggleClass(_.SHOW),e(t).toggleClass(_.SHOW).trigger(e.Event(u.SHOWN,o))}}dispose(){e.removeData(this._element,o),e(this._element).off(r),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)}update(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()}_addEventListeners(){e(this._element).on(u.CLICK,e=>{e.preventDefault(),e.stopPropagation(),this.toggle()})}_getConfig(n){return n={...this.constructor.Default,...e(this._element).data(),...n},Util.typeCheckConfig(t,n,this.constructor.DefaultType),n}_getMenuElement(){if(!this._menu){const e=A._getParentFromElement(this._element);e&&(this._menu=e.querySelector(g.MENU))}return this._menu}_getPlacement(){const t=e(this._element.parentNode);let n=m.BOTTOM;return t.hasClass(_.DROPUP)?(n=m.TOP,e(this._menu).hasClass(_.MENURIGHT)&&(n=m.TOPEND)):t.hasClass(_.DROPRIGHT)?n=m.RIGHT:t.hasClass(_.DROPLEFT)?n=m.LEFT:e(this._menu).hasClass(_.MENURIGHT)&&(n=m.BOTTOMEND),n}_detectNavbar(){return e(this._element).closest(".navbar").length>0}_getPopperConfig(){const e={};"function"==typeof this._config.offset?e.fn=(e=>(e.offsets={...e.offsets,...this._config.offset(e.offsets)||{}},e)):e.offset=this._config.offset;const t={placement:this._getPlacement(),modifiers:{offset:e,flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return"static"===this._config.display&&(t.modifiers.applyStyle={enabled:!1}),t}static _jQueryInterface(t){return this.each(function(){let n=e(this).data(o);if(n||(n=new A(this,"object"==typeof t?t:null),e(this).data(o,n)),"string"==typeof t){if("undefined"==typeof n[t])throw new TypeError(`No method named "${t}"`);n[t]()}})}static _clearMenus(t){if(t&&(t.which===p||"keyup"===t.type&&t.which!==c))return;const n=[].slice.call(document.querySelectorAll(g.DATA_TOGGLE));for(let r=0,i=n.length;r<i;r++){const i=A._getParentFromElement(n[r]),s=e(n[r]).data(o),a={relatedTarget:n[r]};if(t&&"click"===t.type&&(a.clickEvent=t),!s)continue;const l=s._menu;if(!e(i).hasClass(_.SHOW))continue;if(t&&("click"===t.type&&/input|textarea/i.test(t.target.tagName)||"keyup"===t.type&&t.which===c)&&e.contains(i,t.target))continue;const h=e.Event(u.HIDE,a);e(i).trigger(h),h.isDefaultPrevented()||("ontouchstart"in document.documentElement&&e(document.body).children().off("mouseover",null,e.noop),n[r].setAttribute("aria-expanded","false"),e(l).removeClass(_.SHOW),e(i).removeClass(_.SHOW).trigger(e.Event(u.HIDDEN,a)))}}static _getParentFromElement(e){let t;const n=Util.getSelectorFromElement(e);return n&&(t=document.querySelector(n)),t||e.parentNode}static _dataApiKeydownHandler(t){if(/input|textarea/i.test(t.target.tagName)?t.which===l||t.which!==a&&(t.which!==f&&t.which!==h||e(t.target).closest(g.MENU).length):!d.test(t.which))return;if(t.preventDefault(),t.stopPropagation(),this.disabled||e(this).hasClass(_.DISABLED))return;const n=A._getParentFromElement(this),o=e(n).hasClass(_.SHOW);if(!o&&(t.which!==a||t.which!==l)||o&&(t.which===a||t.which===l)){if(t.which===a){const t=n.querySelector(g.DATA_TOGGLE);e(t).trigger("focus")}return void e(this).trigger("click")}const r=[].slice.call(n.querySelectorAll(g.VISIBLE_ITEMS));if(0===r.length)return;let i=r.indexOf(t.target);t.which===h&&i>0&&i--,t.which===f&&i<r.length-1&&i++,i<0&&(i=0),r[i].focus()}}return e(document).on(u.KEYDOWN_DATA_API,g.DATA_TOGGLE,A._dataApiKeydownHandler).on(u.KEYDOWN_DATA_API,g.MENU,A._dataApiKeydownHandler).on(`${u.CLICK_DATA_API} ${u.KEYUP_DATA_API}`,A._clearMenus).on(u.CLICK_DATA_API,g.DATA_TOGGLE,function(t){t.preventDefault(),t.stopPropagation(),A._jQueryInterface.call(e(this),"toggle")}).on(u.CLICK_DATA_API,g.FORM_CHILD,e=>{e.stopPropagation()}),e.fn[t]=A._jQueryInterface,e.fn[t].Constructor=A,e.fn[t].noConflict=function(){return e.fn[t]=s,A._jQueryInterface},A})($);export default Dropdown;