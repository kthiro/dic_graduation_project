import $ from"jquery";import Popper from"popper.js";import Util from"./util";const Tooltip=(t=>{const e="tooltip",i="4.1.3",n="bs.tooltip",s=`.${n}`,o=t.fn[e],r="bs-tooltip",l=new RegExp(`(^|\\s)${r}\\S+`,"g"),a={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(number|string)",container:"(string|element|boolean)",fallbackPlacement:"(string|array)",boundary:"(string|element)"},c={AUTO:"auto",TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},h={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:0,container:!1,fallbackPlacement:"flip",boundary:"scrollParent"},g={SHOW:"show",OUT:"out"},u={HIDE:`hide${s}`,HIDDEN:`hidden${s}`,SHOW:`show${s}`,SHOWN:`shown${s}`,INSERTED:`inserted${s}`,CLICK:`click${s}`,FOCUSIN:`focusin${s}`,FOCUSOUT:`focusout${s}`,MOUSEENTER:`mouseenter${s}`,MOUSELEAVE:`mouseleave${s}`},m={FADE:"fade",SHOW:"show"},p={TOOLTIP:".tooltip",TOOLTIP_INNER:".tooltip-inner",ARROW:".arrow"},f={HOVER:"hover",FOCUS:"focus",CLICK:"click",MANUAL:"manual"};class d{constructor(t,e){if(void 0===Popper)throw new TypeError("Bootstrap tooltips require Popper.js (https://popper.js.org)");this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this.element=t,this.config=this._getConfig(e),this.tip=null,this._setListeners()}static get VERSION(){return i}static get Default(){return h}static get NAME(){return e}static get DATA_KEY(){return n}static get Event(){return u}static get EVENT_KEY(){return s}static get DefaultType(){return a}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(e){if(this._isEnabled)if(e){const i=this.constructor.DATA_KEY;let n=t(e.currentTarget).data(i);n||(n=new this.constructor(e.currentTarget,this._getDelegateConfig()),t(e.currentTarget).data(i,n)),n._activeTrigger.click=!n._activeTrigger.click,n._isWithActiveTrigger()?n._enter(null,n):n._leave(null,n)}else{if(t(this.getTipElement()).hasClass(m.SHOW))return void this._leave(null,this);this._enter(null,this)}}dispose(){clearTimeout(this._timeout),t.removeData(this.element,this.constructor.DATA_KEY),t(this.element).off(this.constructor.EVENT_KEY),t(this.element).closest(".modal").off("hide.bs.modal"),this.tip&&t(this.tip).remove(),this._isEnabled=null,this._timeout=null,this._hoverState=null,this._activeTrigger=null,null!==this._popper&&this._popper.destroy(),this._popper=null,this.element=null,this.config=null,this.tip=null}show(){if("none"===t(this.element).css("display"))throw new Error("Please use show on visible elements");const e=t.Event(this.constructor.Event.SHOW);if(this.isWithContent()&&this._isEnabled){t(this.element).trigger(e);const i=t.contains(this.element.ownerDocument.documentElement,this.element);if(e.isDefaultPrevented()||!i)return;const n=this.getTipElement(),s=Util.getUID(this.constructor.NAME);n.setAttribute("id",s),this.element.setAttribute("aria-describedby",s),this.setContent(),this.config.animation&&t(n).addClass(m.FADE);const o="function"==typeof this.config.placement?this.config.placement.call(this,n,this.element):this.config.placement,r=this._getAttachment(o);this.addAttachmentClass(r);const l=!1===this.config.container?document.body:t(document).find(this.config.container);t(n).data(this.constructor.DATA_KEY,this),t.contains(this.element.ownerDocument.documentElement,this.tip)||t(n).appendTo(l),t(this.element).trigger(this.constructor.Event.INSERTED),this._popper=new Popper(this.element,n,{placement:r,modifiers:{offset:{offset:this.config.offset},flip:{behavior:this.config.fallbackPlacement},arrow:{element:p.ARROW},preventOverflow:{boundariesElement:this.config.boundary}},onCreate:t=>{t.originalPlacement!==t.placement&&this._handlePopperPlacementChange(t)},onUpdate:t=>{this._handlePopperPlacementChange(t)}}),t(n).addClass(m.SHOW),"ontouchstart"in document.documentElement&&t(document.body).children().on("mouseover",null,t.noop);const a=()=>{this.config.animation&&this._fixTransition();const e=this._hoverState;this._hoverState=null,t(this.element).trigger(this.constructor.Event.SHOWN),e===g.OUT&&this._leave(null,this)};if(t(this.tip).hasClass(m.FADE)){const e=Util.getTransitionDurationFromElement(this.tip);t(this.tip).one(Util.TRANSITION_END,a).emulateTransitionEnd(e)}else a()}}hide(e){const i=this.getTipElement(),n=t.Event(this.constructor.Event.HIDE),s=()=>{this._hoverState!==g.SHOW&&i.parentNode&&i.parentNode.removeChild(i),this._cleanTipClass(),this.element.removeAttribute("aria-describedby"),t(this.element).trigger(this.constructor.Event.HIDDEN),null!==this._popper&&this._popper.destroy(),e&&e()};if(t(this.element).trigger(n),!n.isDefaultPrevented()){if(t(i).removeClass(m.SHOW),"ontouchstart"in document.documentElement&&t(document.body).children().off("mouseover",null,t.noop),this._activeTrigger[f.CLICK]=!1,this._activeTrigger[f.FOCUS]=!1,this._activeTrigger[f.HOVER]=!1,t(this.tip).hasClass(m.FADE)){const e=Util.getTransitionDurationFromElement(i);t(i).one(Util.TRANSITION_END,s).emulateTransitionEnd(e)}else s();this._hoverState=""}}update(){null!==this._popper&&this._popper.scheduleUpdate()}isWithContent(){return Boolean(this.getTitle())}addAttachmentClass(e){t(this.getTipElement()).addClass(`${r}-${e}`)}getTipElement(){return this.tip=this.tip||t(this.config.template)[0],this.tip}setContent(){const e=this.getTipElement();this.setElementContent(t(e.querySelectorAll(p.TOOLTIP_INNER)),this.getTitle()),t(e).removeClass(`${m.FADE} ${m.SHOW}`)}setElementContent(e,i){const n=this.config.html;"object"==typeof i&&(i.nodeType||i.jquery)?n?t(i).parent().is(e)||e.empty().append(i):e.text(t(i).text()):e[n?"html":"text"](i)}getTitle(){let t=this.element.getAttribute("data-original-title");return t||(t="function"==typeof this.config.title?this.config.title.call(this.element):this.config.title),t}_getAttachment(t){return c[t.toUpperCase()]}_setListeners(){this.config.trigger.split(" ").forEach(e=>{if("click"===e)t(this.element).on(this.constructor.Event.CLICK,this.config.selector,t=>this.toggle(t));else if(e!==f.MANUAL){const i=e===f.HOVER?this.constructor.Event.MOUSEENTER:this.constructor.Event.FOCUSIN,n=e===f.HOVER?this.constructor.Event.MOUSELEAVE:this.constructor.Event.FOCUSOUT;t(this.element).on(i,this.config.selector,t=>this._enter(t)).on(n,this.config.selector,t=>this._leave(t))}t(this.element).closest(".modal").on("hide.bs.modal",()=>this.hide())}),this.config.selector?this.config={...this.config,trigger:"manual",selector:""}:this._fixTitle()}_fixTitle(){const t=typeof this.element.getAttribute("data-original-title");(this.element.getAttribute("title")||"string"!==t)&&(this.element.setAttribute("data-original-title",this.element.getAttribute("title")||""),this.element.setAttribute("title",""))}_enter(e,i){const n=this.constructor.DATA_KEY;(i=i||t(e.currentTarget).data(n))||(i=new this.constructor(e.currentTarget,this._getDelegateConfig()),t(e.currentTarget).data(n,i)),e&&(i._activeTrigger["focusin"===e.type?f.FOCUS:f.HOVER]=!0),t(i.getTipElement()).hasClass(m.SHOW)||i._hoverState===g.SHOW?i._hoverState=g.SHOW:(clearTimeout(i._timeout),i._hoverState=g.SHOW,i.config.delay&&i.config.delay.show?i._timeout=setTimeout(()=>{i._hoverState===g.SHOW&&i.show()},i.config.delay.show):i.show())}_leave(e,i){const n=this.constructor.DATA_KEY;(i=i||t(e.currentTarget).data(n))||(i=new this.constructor(e.currentTarget,this._getDelegateConfig()),t(e.currentTarget).data(n,i)),e&&(i._activeTrigger["focusout"===e.type?f.FOCUS:f.HOVER]=!1),i._isWithActiveTrigger()||(clearTimeout(i._timeout),i._hoverState=g.OUT,i.config.delay&&i.config.delay.hide?i._timeout=setTimeout(()=>{i._hoverState===g.OUT&&i.hide()},i.config.delay.hide):i.hide())}_isWithActiveTrigger(){for(const t in this._activeTrigger)if(this._activeTrigger[t])return!0;return!1}_getConfig(i){return"number"==typeof(i={...this.constructor.Default,...t(this.element).data(),..."object"==typeof i&&i?i:{}}).delay&&(i.delay={show:i.delay,hide:i.delay}),"number"==typeof i.title&&(i.title=i.title.toString()),"number"==typeof i.content&&(i.content=i.content.toString()),Util.typeCheckConfig(e,i,this.constructor.DefaultType),i}_getDelegateConfig(){const t={};if(this.config)for(const e in this.config)this.constructor.Default[e]!==this.config[e]&&(t[e]=this.config[e]);return t}_cleanTipClass(){const e=t(this.getTipElement()),i=e.attr("class").match(l);null!==i&&i.length&&e.removeClass(i.join(""))}_handlePopperPlacementChange(t){const e=t.instance;this.tip=e.popper,this._cleanTipClass(),this.addAttachmentClass(this._getAttachment(t.placement))}_fixTransition(){const e=this.getTipElement(),i=this.config.animation;null===e.getAttribute("x-placement")&&(t(e).removeClass(m.FADE),this.config.animation=!1,this.hide(),this.show(),this.config.animation=i)}static _jQueryInterface(e){return this.each(function(){let i=t(this).data(n);const s="object"==typeof e&&e;if((i||!/dispose|hide/.test(e))&&(i||(i=new d(this,s),t(this).data(n,i)),"string"==typeof e)){if("undefined"==typeof i[e])throw new TypeError(`No method named "${e}"`);i[e]()}})}}return t.fn[e]=d._jQueryInterface,t.fn[e].Constructor=d,t.fn[e].noConflict=function(){return t.fn[e]=o,d._jQueryInterface},d})($);export default Tooltip;